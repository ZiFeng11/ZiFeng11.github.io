!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.wpkReporter=t():e.wpkReporter=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t){e.exports={sdk:{BID:"wpkreporter",CID:"jssdk",WID_KEY:"__wpkreporterwid_"},env:{BROWSER:"browser",NODEJS:"nodejs",WEEX:"weex"},px:{signKey:"Uvn#08uefVdwe&c4",addr:{cn:"http://px.effirst.com/api/v1/jssdk/upload",cn_https:"https://px.effirst.com/api/v1/jssdk/upload",quark:"http://px.wpk.quark.cn/api/v1/jssdk/upload",quark_https:"https://px.wpk.quark.cn/api/v1/jssdk/upload",intl:"http://px-intl.ucweb.com/api/v1/jssdk/upload",intl_https:"https://px-intl.ucweb.com/api/v1/jssdk/upload",qg:"http://px-itrace.xuexi.cn/api/v1/jssdk/upload",qg_https:"https://px-itrace.xuexi.cn/api/v1/jssdk/upload"},confAddr:{cn:"http://px.effirst.com/api/v1/jconfig",cn_https:"https://px.effirst.com/api/v1/jconfig",intl:"http://px-intl.ucweb.com/api/v1/jconfig",intl_https:"https://px-intl.ucweb.com/api/v1/jconfig",qg:"http://px-itrace.xuexi.cn/api/v1/jconfig",qg_https:"https://px-itrace.xuexi.cn/api/v1/jconfig",quark:"http://px.wpk.quark.cn/api/v1/jconfig",quark_https:"https://px.wpk.quark.cn/api/v1/jconfig"}},http:{methods:{GET:"GET",PUT:"PUT",POST:"POST",HEAD:"HEAD",DELETE:"DELETE",OPTIONS:"OPTIONS",CONNECT:"OPTIONS",TRACE:"OPTIONS",PATCH:"OPTIONS"},protocols:{HTTP:"http:",HTTPS:"https:"}},category:{JSERR:1,API:2,JSFSPERF:3,RESLOADFAIL:4,FLOW:5,BKPG:6,HARLOG:7,PERFNEXT:1e3,MAINDOC:1e5,RESTIMING:100001},navConn:{types:{BLUETOOTH:"bluetooth",CELLULAR:"cellular",ETHERNET:"ethernet",MIXED:"mixed",NONE:"none",OTHER:"other",UNKNOWN:"unknown",WIFI:"wifi",WIMAX:"wimax"},effectiveTypes:{"2G":"2g","3G":"3g","4G":"4g",SLOW2G:"slow-2g"}}}},function(e,t,r){var n=r(6),o=r(0),i=o.px,a=o.category;function s(e){if(!(this instanceof s))return new s(e);e=e||{},this._init=!1,this.toolKit=n(e),this.logger=this.toolKit.logger,this.debug=e.debug||!1,!0===e.debug&&this.logger.warn("[wpk] now in debug mode, you can see log details"),this._plugins=e.plugins||[],this.bid=e.bid,this.utdid=e.utdid,this.cid=e.cid,this.uid=e.uid,this.rel=e.rel,this.spa=e.spa||!1,this.delay=!1!==e.delay,this.sampleRate=e.sampleRate,this.ignoreScriptError=!1!==e.ignoreScriptError,this.onlyCustom=e.onlyCustomInUCCore||e.onlyCustom||!1,this.ignoreU4HA=!0===e.ignoreU4HA,this.beforeSend=e.beforeSend||null,this.checkHidden=!1!==e.checkHidden,this.enableMtop=e.enableMtop||!1,this.prerender=!0===e.prerender,this.supportBeaconBody=!1!==e.supportBeaconBody,this.blockAlipayMiniAppWebview=e.blockAlipayMiniAppWebview||!1,this.maxSessDuration=e.maxSessDuration||288e5,this._waitingQueue=[],this.useNativeCH=!1!==e.useNativeCH,!e.cluster&&this.toolKit.isQuark()?this.cluster="quark":this.cluster=e.cluster||"cn"}function c(e){if(e.toolKit.inAlipayMiniAppWebview()&&!0===e.blockAlipayMiniAppWebview)e.logger.warn("current runtime is alipay miniapp webview, this request will be blocked.");else{var t=i.confAddr[e.cluster+(e.isHttps?"_https":"")],r=i.signKey;e._startTime=Date.now(),e._dying=!0,e.toolKit.dynamicConf(e.bid,e.VERSION,t,r,(function(t){e._dying=!1,e._dyConf=t,e.logger.warn("jconfig come back")}))}}s.prototype={VERSION:"1.2.7",initialize:function(e){this.env=e.env,e.root.location&&-1!==e.root.location.search.indexOf("wpkReporterDebug=true")&&(this.debug=!0),this.send=e.send,this.getWid=e.getWid,this.isHttps=e.isHttps,e.bindUnloadEvent(this)},ready:function(){return this._init},setConfig:function(e){return this.toolKit.isObject(e)&&this.toolKit.extend(this,e),this},report:function(e){"string"==typeof e&&(e={category:a.JSERR,msg:e});var t=e.sampleRate||this.sampleRate;if(t||0===t||(t=1),this.toolKit.canReport(t)){if(this._cleanData(e),this.ready()){var r;if("function"==typeof this.beforeSend){try{r=this.beforeSend(e)}catch(e){this.logger.error("exec beforeSend failed for:",e)}if(!1===r)return void this.logger.warn("beforeSend func return false");"object"==typeof r&&(e=r)}var n=this.toolKit.getMetas(),o=e.bid||this.bid||n.wpkBid,s=e.cid||this.cid||n.wpkCid,u=e.rel||this.rel||n.wpkRel;this.toolKit.isFunction(u)&&(u=u());var l=e.uid||this.uid;if(this.toolKit.isFunction(l)&&(l=l()),l||(l=this.getWid()),Date.now()-this._begin>=this.maxSessDuration&&(this._begin=Date.now(),this._sid=this.toolKit.getSessionId()),this.toolKit.extend(e,{w_bid:o,w_cid:s,w_rel:u,w_spa:this.spa,w_tm:this.toolKit.timestamp(),w_cnt:1,uid:l,utdid:this.utdid,type:this.toolKit.categoryToType(e.category),sdk_ver:this.VERSION,log_src:"jssdk",uc_param:this.uc_param||"",wid:this.wid}),this._dyConf&&Date.now()<this._dyConf.expireAt){var p=void 0!==this._dyConf[e.type+"@"+e.category]?this._dyConf[e.type+"@"+e.category]:this._dyConf[e.type];if(void 0!==(p=void 0!==p?p:this._dyConf.all)&&!this.toolKit.canReport(p))return void this.logger.warn("由于「动态配置」采样率控制，本条日志最终未上报，类型: ",e.type,e.category," 采样率: ",p)}else!this._dying&&Date.now()-this._startTime>=18e5&&(this.logger.warn("syncing dynamic config"),c(this));var d={app:o,cp:"none",de:4,seq:this.toolKit.generateSeq(),tm:this.toolKit.timestamp(!0),ud:encodeURIComponent(e.uid),ver:e.w_rel,type:e.type,sver:e.sdk_ver,sign:"9bf8a190ef82c5049df7b199c599c45b"},f=i.addr[this.cluster+(this.isHttps?"_https":"")],g=this.toolKit.objToQueryString(d);this.toolKit.cutStr(e,["c1","c2","c3","c4","c5"],128),this.send(f,g,e)}else this._waitingQueue.push(e),this.logger.warn("sdk未完成初始化，数据已缓存");return this}this.logger.warn("由于采样率控制，本条日志最终未上报，采样率: ",t)},_cleanData:function(e){for(var t,r=1;r<=10;r++)t="bl"+r,e.hasOwnProperty(t)&&(e["w_"+t]=e[t],delete e[t]);t=null},reportFlow:function(e){return e=e||{},this.report(this.toolKit.extend(e||{},{category:a.FLOW,sampleRate:1})),this},reportError:function(e,t){return this.toolKit.isError(e)?((t=t||{}).category=a.JSERR,t.w_msg=e.toString(),t.stack=this.toolKit.parseErrorStack(e),t.w_file=e.filename||"",t.w_line=e.lineno||"",t.w_col=e.colno||"",this.report(t),this):this.report(e,t)},reportApi:function(e,t){this.reportApiError(e,t)},reportApiError:function(e,t){return e&&(this.toolKit.isObject(e.queryString)&&(e.queryString=this.toolKit.objToQueryString(e.queryString)),this.report(this.toolKit.extend(t||{},{msg:e.msg||"",w_res:e.url,w_method:e.method,w_param:e.queryString,w_body:JSON.stringify(e.body),w_resp:e.response,w_rc:e.status,w_rt:e.spent||0,c1:e.c1,c2:e.c2,c3:e.c3,c4:e.c4,c5:e.c5},{category:a.API,w_type:16}))),this},reportBlankPage:function(e){return(e=e||{}).hasOwnProperty("w_fp")||this.toolKit.extend(e,{w_fp:999}),this.report(this.toolKit.extend(e||{},{category:a.BKPG})),this},diagnose:function(){this.ready()?this.bid?(this.sampleRate||this.logger.warn("没有设置采样率参数sampleRate，将使用默认采样率"),this.report({_diagnose:!0})):this.logger.warn("缺少bid参数,请确认是否已正确设置"):this.logger.warn("wpkReporter尚未初始化，请确保已调用 install 方法")},addPlugin:function(e,t){return this._plugins.push([e,t]),"function"==typeof e&&this._init&&e.apply(this,[this,t]),this},install:function(){var e;c(this),this.toolKit.isCompassPrerender()&&((e=this).toolKit.onListen(document,"prerendercommit",(function(){e.prerenderCommit()}),!0),e.toolKit.onListen(document,"touchstart",(function(){e.prerenderCommit()}),!0),this.prerender=!0);for(var t=r(2),n=this._plugins.length,o=!1,i=0;i<n;i++){var a=this._plugins[i],s=a[0],u=a[1];s.prototype.pluginId===t.prototype.pluginId&&(o=!0),s.apply(this,[this,u])}return this.wid=this.getWid(),this._begin=Date.now(),this._sid=this.toolKit.getSessionId(),this._init=!0,0!==n&&o||(this.toolKit.logger.info("没有设置Flow，内置开启"),this.addPlugin(t)),this.prerender&&this.toolKit.logger.warn("预渲染环境, 白屏、性能将在上屏后开始检测"),this},installAll:function(){var e=[[r(8),{resErr:!0}],[r(9)],[r(10)],[r(2)],[r(11),{params:"prveosfrnwutsv"}]],t=this._plugins.length;if(0===t)this._plugins=e;else{for(var n=[],o=e.length,i=0;i<o;i++){for(var a=e[i],s=0;s<t;s++)if(a[0].prototype.pluginId===this._plugins[s][0].prototype.pluginId){a=this._plugins[s];break}n.push(a)}this._plugins=n}return this.install()},uninstall:function(){return this._plugins=[],this._init=!1,this},prerenderCommit:function(){if(this.__isPrerenderCommited)this.logger.warn("prerenderCommit can only call once.");else{this.__isPrerenderCommited=!0,this.logger.info("prerender commit event");var e=new Event("wpkpageforeground");window.dispatchEvent(e)}}},e.exports=s},function(e,t,r){var n=r(0).env,o=function(e){var t;return(e?(t=e.replace(/^#\/?/,""))&&"string"==typeof t?t.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):"":"")||"[index]"},i=function(e,t){if(t=t||{},e.env===n.BROWSER&&window)if(e.toolKit.extend({enable:!0},t).enable){e.logger.info("wpkflowPlugin已开启");var i,a,s=function(){e.reportFlow()};e.toolKit.isPageReady(e.prerender)?setTimeout(s,0):e.toolKit.onPageReady(s,!0,e.prerender),e.spa&&(r(7)(),i=function(t){o(location.hash)&&(e._begin=Date.now(),e._sid=e.toolKit.getSessionId(),e.reportFlow())},a=function(t){o(t.detail)&&(e._begin=Date.now(),e._sid=e.toolKit.getSessionId(),e.reportFlow())},e.toolKit.onListen(window,"hashchange",i),e.toolKit.onListen(window,"historystatechange",a)),e.toolKit.onListen(window,"beforeunload",(function(){e.toolKit.offListen(window,"load"),e.toolKit.offListen(window,"hashchange"),e.toolKit.offListen(window,"historystatechange"),s=i=a=null}))}else e.logger.info("wpkflowPlugin已关闭")};i.prototype.pluginId="flow",e.exports=i},function(e,t,r){(function(t){var n="object"==typeof t&&t+""=="[object process]",o="function"==typeof callNative||"function"==typeof nativeLog;e.exports=r(o?5:n?13:16)}).call(this,r(4))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],l=!1,p=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function w(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new g(e,t)),1!==u.length||l||s(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=w,o.addListener=w,o.once=w,o.off=w,o.removeListener=w,o.removeAllListeners=w,o.emit=w,o.prependListener=w,o.prependOnceListener=w,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){var n=r(1),o=r(12);e.exports=function(e){var t=new n(e);return t.initialize(o),t}},function(e,t){var r=function(e){return e||""},n=function(e){var t=Date.now();"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now&&(t+=performance.now());var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:11&r).toString(16)}));return!1===e?r.replace(/-/g,""):r},o=function(e){return"object"==typeof e},i=function(e){var t={}.toString.call(e);return o(e)&&("[object Error]"===t||"[object Exception]"===t||t instanceof Error)},a=function(e){return"[object Array]"==={}.toString.call(e)},s=function(e){return"function"==typeof e},c=function(e){return"string"==typeof e},u=function(e){var t=+new Date;return!0===e&&(t=Math.floor(t/1e3)),t},l=function(e){if(e.stack){var t=e.stack.split("\n");return t.shift(),t.join("\n")}return""},p=function(e){var t;switch(e){case 1:t="jserr";break;case 2:t="api";break;case 3:t="jsfsperf";break;case 4:t="resloadfail";break;case 5:t="flow";break;case 6:t="bkpg";break;case 7:t="harlog";break;default:t="jssdkidx"}return t},d=function(){return u()+Math.floor(10*Math.random())},f=function(e){var t=[];for(var r in e)t.push(r+"="+e[r]);return t.join("&")},g=function(e){return JSON?JSON.stringify(e):e.toString()},w=function(){if("undefined"!=typeof document&&document.getElementsByTagName)for(var e,t,r,n,o=document.getElementsByTagName("meta"),i=o.length,a=0;a<i;a++)"wpk-bid"===(n=o[a]).name?e=n.content:"wpk-cid"===n.name?t=n.content:"wpk-rel"===n.name&&(r=n.content);return{wpkBid:e||null,wpkCid:t||null,wpkRel:r||null}},h=function(e){return e&&H()?o(window)&&window.prerenderCommitEvent&&o(window.prerenderCommitEvent)&&"prerendercommit"===window.prerenderCommitEvent.type:"complete"===document.readyState},v=function(e,t,r){m(window,r?"wpkpageforeground":"load",(function(n){r&&"complete"!==document.readyState?m(window,"load",e,t):e.call(this,n)}),t)},m=function(e,t,r,n){return e.addEventListener?e.addEventListener(t,(function o(i){n&&e.removeEventListener(t,o,!1),r.call(this,i)}),!1):e.attachEvent&&e.attachEvent("on"+t,(function o(i){n&&e.detachEvent("on"+t,o),r.call(this,i)})),this},y=function(e,t,r){return r?(e.removeEventListener?e.removeEventListener(t,r):e.detachEvent&&e.detachEvent(t,r),this):this},_=function(e){return!!e&&(0!==e&&(e>=1||"100%"===e||(/^\d+(\.\d+)?%$/.test(e)?Math.random()<parseFloat(e)/100:e>0&&e<1&&Math.random()<e)))},b="wpk-reporter",x=function(e,t){var r=[].slice.call(t);e.apply(this,[b].concat(r))},E=function(e){var t="";switch(e.category){case 1:t=[e.category,e.uid,e.w_url,e.w_ref,e.w_msg||"",e.w_line||"",e.w_col||""].join("");break;case 2:t=[e.category,e.uid,e.w_res,e.w_method,e.w_rc].join("");break;case 4:t=[e.category,e.uid,e.w_url,e.w_ref,e.w_res,e.w_type].join("")}return t},S=function(e,t){e=e||!1;try{if("undefined"!=typeof window&&window.ucweb&&window.ucweb.window||t){for(var r=(t||navigator.userAgent).split(" "),n=r.length,o=!1,i=!1,a=0;a<n;a++)if(-1!==r[a].indexOf("UWS/")){var s=r[a].split("/");i=k(s[1],"2.13.2.37")}else-1!==r[a].indexOf("AliApp(DingTalk/")&&(o=!0);return o?i:e}}catch(e){}return!1},k=function(e,t){try{for(var r,n,o=e.split("."),i=t.split("."),a=o.length,s=0;s<a;s++)if((r=parseInt(o[s]))!==(n=parseInt(i[s])))return r>n;return!0}catch(e){}return!1},R=function(e){try{const t="__wpktestingls__";return e().setItem(t,t),e().removeItem(t),!0}catch(e){return!1}};function O(){return localStorage}var T={get:function(e){if(R(O)){var t=O().getItem(e);if(t){if(t=JSON.parse(t),Date.now()<t.expireAt)return t;this.rm(e)}}return null},set:function(e,t){R(O)&&e&&t&&(t.expireAt=Date.now()+18e5,O().setItem(e,JSON.stringify(t)))},rm:function(e){R(O)&&O().removeItem(e)}};function C(){return sessionStorage}var j=function(){var e=n();return R(C)&&C().setItem("wpkreporter:frmid",e),e},K=function(e,t){if(t){if(1===t.length)return e===t[0];if(2===t.length){var r=t[0],n=t[1];return r&&!n?o(e,r):r&&n?o(e,r)&&o(n,e):o(n,e)}return!1}return!0;function o(e,t){var r=e.split("."),n=t.split(".");return!(parseInt(r[0])<parseInt(n[0]))&&(parseInt(r[0])>parseInt(n[0])||!(parseInt(r[1])<parseInt(n[1]))&&(parseInt(r[1])>parseInt(n[1])||parseInt(r[2])>=parseInt(n[2])))}},I=function(e,t,r,o,i){var a="wpkreporter:dynamicConf:"+e,c=T.get(a);if(c)s(i)&&i(c);else{var l={app:e,tm:u(!0),ud:n(),sver:t,sign:"c41e43c828c16c16a6eb1c9c1e68e8ce"},p=f(l);!function(e,t){if("undefined"==typeof XMLHttpRequest)t();else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){var e;if(200===r.status&&r.response)try{var n=JSON.parse(r.response);0===n.code&&(e=n.config||[])}catch(e){}t(e)}};try{r.open("GET",e,!0),r.timeout=3e3,r.send()}catch(e){}}}(r+"?wpk-header="+encodeURIComponent(p),(function(e){if(c={},void 0!==e){for(var r=e.length,n=0;n<r;n++){var o=e[n],u=o.sdkver;if(K(t,u)){if(o.common&&void 0!==o.common.sampleRate&&(c.all=o.common.sampleRate),o.config)for(var l,p=o.config.length,d=0;d<p;d++)if((l=o.config[d]).type){if(l.category_rate)for(var f in l.category_rate)c[l.type+"@"+f]=l.category_rate[f];l.sampleRate&&(c[l.type]=l.sampleRate)}break}}T.set(a,c)}s(i)&&i(c)}))}},A=function(e,t,r){for(var n,o=t.length,i=0;i<o;i++)"string"==typeof(n=e[t[i]])?e[t[i]]=n.substring(0,r):"object"==typeof n&&(e[t[i]]=String(n))},P="undefined"!=typeof navigator?(navigator.userAgent||"").toLowerCase():"",L=function(){return P.indexOf("ucbrowser/")>-1},q=function(){return P.indexOf("quark/")>-1},N=function(){var e=!1;try{if("undefined"!=typeof navigator){var t=-1!==navigator.userAgent.indexOf("Alipay"),r=-1!==navigator.userAgent.indexOf("MiniProgram"),n=-1!==navigator.userAgent.indexOf("APXWebView");e=t&&(r||n)}}catch(e){}return e},H=function(){if("undefined"!=typeof window&&null!==window){if(window.ucweb&&window.ucweb.window&&window.ucweb.window.performance&&3===window.ucweb.window.performance.pt)return!0;if(window.compass&&window.compass.env&&o(window.compass.env))return window.compass.env.isPrerender}return!1};e.exports=function(e){return{noop:r,uuid:n,isError:i,isArray:a,isObject:o,isFunction:s,isString:c,getSessionId:j,logger:"undefined"!=typeof console&&o(console)&&e.debug?{trace:function(){x(console.trace,arguments)},debug:function(){x(console.debug,arguments)},log:function(){x(console.log,arguments)},info:function(){x(console.info,arguments)},warn:function(){x(console.warn,arguments)},error:function(){x(console.error,arguments)}}:{trace:r,debug:r,log:r,info:r,warn:r,error:r},extend:function(e){for(var t=1,r=arguments.length;t<r;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},some:function(e,t){if(!this.isArray(e)||!this.isFunction(t))return!1;for(var r,n=e.length,o=0;o<n;o++)if(r=e[o],t.call(this,r))return!0;return!1},filter:function(e,t){var r=[];try{for(var n=0,o=e.length;n<o;n++)t.call(this,e[n],n,e)&&r.push(e[n]);return r}catch(e){}return e},forEach:function(e,t){if(this.isArray(e)&&this.isFunction(t))for(var r,n=e.length,o=0;o<n;o++)r=e[o],t.call(this,r,o,e)},trim:function(e){if(this.isString(e))return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},canReport:_,onListen:m,offListen:y,getMetas:w,timestamp:u,generateSeq:d,categoryToType:p,parseErrorStack:l,objToJsonString:g,objToQueryString:f,genContentHash:E,isU4HA:S,isUC:L,isQuark:q,cutStr:A,dynamicConf:I,inAlipayMiniAppWebview:N,isCompassPrerender:H,isPageReady:h,onPageReady:v}}},function(e,t){var r=window.history||{},n=window.document,o=function(e,t){var r;window.CustomEvent?r=new CustomEvent(e,{detail:t}):((r=n.createEvent("HTMLEvents")).initEvent(e,!1,!0),r.detail=t),window.dispatchEvent(r)},i=function(e){return e&&"string"==typeof e?e.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},a=function(e){var t=r[e];"function"==typeof t&&(r[e]=function(e,n,a){var s=location.href,c=t.call(r,e,n,a);if(!a||"string"!=typeof a)return c;if(a===s)return c;try{var u=s.split("#"),l=a.split("#"),p=i(u[0]),d=i(l[0]),f=u[1]&&u[1].replace(/^\/?(.*)/,"$1"),g=l[1]&&l[1].replace(/^\/?(.*)/,"$1");p!==d?o("historystatechange",d):f!==g&&o("historystatechange",g)}catch(e){}return c},r[e].toString=e+"() { [native code] }")};e.exports=function(){a("pushState"),a("replaceState")}},function(e,t,r){var n,o,i=r(0),a=i.env,s=i.category,c=function(e){return"function"==typeof e},u={},l=function(e,t,r,n){e.addEventListener?e.addEventListener(t,r,n||!1):(u["on"+t]=function(){return r.call(e,window.event)},e.attachEvent("on"+t,u["on"+t]))},p=function(e,t){var r=e.id?"#"+e.id:"",n="";e.className&&"string"==typeof e.className&&(n="."+e.className.split(" ").join("."));var o=e.tagName.toLowerCase();return e.parentNode&&e.parentNode.tagName&&t-1!=0?p(e.parentNode,t-1)+" > "+o.toLowerCase()+r+n:o+r+n},d=function(e,t,r,i,a,u){if(n)try{n.call(this,t,r,i,a,u)}catch(u){}if("script error."===(t||"").toLowerCase()){if(e.ignoreScriptError||o.ignoreScriptError)return void e.logger.warn("配置了ignoreScriptError，本次异常将不上报");t="Script error",u=u||{}}if(!c(o.jsErrFilter)||o.jsErrFilter.call(this,event)){if(null!=u){var l=(u.stack||"").split("\n");l.shift();var p={w_msg:t,w_file:r||"",w_line:i||"",w_col:a||"",stack:l.join("\n"),category:s.JSERR,sampleRate:o.jsErrSampleRate};e.report(p)}}else e.logger.warn("jserrFilter 返回false，本次日志将不上报, event: ",event)},f=function(e,t){var r=window;r&&e.env===a.BROWSER?(e.logger.info("wpkglobalerrorPlugin已开启"),!1!==(o=e.toolKit.extend({jsErrSampleRate:1,resErrSampleRate:1},t)).jsErr?(n=r.onerror,r.onerror=function(t,r,n,o,i){d(e,t,r,n,o,i)},l(r,"unhandledrejection",(function(t){var r=t.type;"string"==typeof t.reason?r=t.reason:t.reason&&"object"==typeof t.reason&&t.reason.message&&(r=t.reason.message),d(e,r,null,null,null,t.reason||t.type)}))):e.logger.warn("js异常监控已关闭"),o.resErr?l(r,"error",(function(t){!function(e,t){if(!t.target.tagName||t.message||t.filename||t.lineno||t.colno)e.logger.warn("非资源获取问题，跳出处理, event: ",t);else if(!c(o.resErrFilter)||o.resErrFilter.call(this,t)){var r=t.target.src||t.target.href;r===window.location.href&&(r="EMPTY_SRC");var n,i=function(e){var t=-1;switch(e.tagName.toLowerCase()){case"img":t=1;break;case"link":e.rel&&"stylesheet"===e.rel.toLowerCase()&&(t=2);break;case"script":t=3;break;case"video":t=11}return t}(t.target);11===i&&t.target.error&&(n=t.target.error.code),e.report({category:s.RESLOADFAIL,sampleRate:o.resErrSampleRate,msg:r+" 加载失败",w_res:r,w_type:i,w_err:n,w_xpath:p(t.target,5)})}else e.logger.warn("reserrFilter 返回false，本次日志将不上报, event: ",t)}(e,t)}),!0):e.logger.warn("资源加载异常监控已关闭")):e.logger.warn("全局错误监控插件不支持非浏览器环境")};f.prototype.pluginId="gerror",e.exports=f},function(e,t,r){var n=r(0),o=n.sdk,i=n.http.methods,a=n.category,s=function(e){return e>=200&&e<=299},c=function(e){return-1===e.indexOf("//arms-retcode")&&-1===e.indexOf("//retcode.taobao.com")&&-1===e.indexOf("aliyuncs.com/r.png")&&-1===e.indexOf("//mdap.alipay.com/loggw")&&-1===e.indexOf("//wpk-gateway")&&-1===e.indexOf("//px.wpk.quark.cn")&&-1===e.indexOf("//px.ucweb.com")&&-1===e.indexOf("//px.effirst.com")&&-1===e.indexOf("//px-intl.ucweb.com")&&-1===e.indexOf("//gm.mmstat.com/arms.1.1")&&-1===e.indexOf("//gm.mmstat.com/arms.1.2")&&-1===e.indexOf("//g.alicdn.com/alilog")&&-1===e.indexOf("//log.m.sm.cn/0.gif")},u=function(e,t){if(e.hasOwnProperty(t))return e[t]},l=function(e,t,r){e.toolKit.isObject(r)&&e.toolKit.extend(t,{c1:u(r,"c1"),c2:u(r,"c2"),c3:u(r,"c3"),c4:u(r,"c4"),c5:u(r,"c5"),bl1:u(r,"bl1"),bl2:u(r,"bl2"),bl3:u(r,"bl3"),bl4:u(r,"bl4"),bl5:u(r,"bl5")}),e.report(t)},p=location.origin,d=function(e){return!e||(0===e.indexOf(p)||!/^(\/\/|http:|https:).*/.test(e))};function f(e,t){var r=null;try{var n,o,i,a=e.toolKit.trim(t||"").split(/[\r\n]+/);if(a.length>0)r={},e.toolKit.forEach(a,(function(e){n=e.split(": "),o=n.shift(),i=n.join(": "),r[o]=i}))}catch(e){}return r}function g(e){try{if(!e)return{};var t={};return e.forEach((function(e,r){t[r]=e})),t}catch(e){return{}}}var w=function(e,t){if(e.env===n.env.BROWSER&&window){var r={enable:!0,sampleRate:1,enableTrace:!1,enableCorsTrace:function(e){return!1},requestHeaders:{"x-wpk-reqid":function(){return e.toolKit.uuid(!1)},"x-wpk-bid":function(){return e.bid}},responseHeaders:["x-eagleeye-id","x-wpk-serverid"]},u=e.toolKit.extend(r,t);u.enable?(e.logger.info("wpkinterfacePlugin已开启"),"XMLHttpRequest"in window&&function(e,t){var r=window.XMLHttpRequest.prototype,n=r.open;r.open=function(r,o){this.__reqCtx__={method:r,url:o||"",start:Date.now()};var i=[].slice.call(arguments);n.apply(this,i);var a=this;t.enableTrace&&(d(o)||t.enableCorsTrace(o))&&e.toolKit.forEach(Object.getOwnPropertyNames(t.requestHeaders),(function(e){var r=t.requestHeaders[e]();a.setRequestHeader(e,r)}))};var u=r.setRequestHeader;r.setRequestHeader=function(e,t){var r=[].slice.call(arguments);u.apply(this,r),this.__reqCtx__&&(this.__reqCtx__.headers||(this.__reqCtx__.headers={}),this.__reqCtx__.headers[e]=t)};var p=r.send;r.send=function(r){var n=this;function u(){if(n.__reqCtx__&&4===n.readyState)try{var u=Date.now(),p=(n.responseURL||n.__reqCtx__.url).split("?"),d=p[0],g=p[1]||"",w="",h=n.__reqCtx__.headers||{};n.__reqCtx__.method.toUpperCase()!==i.GET&&r&&(w=JSON.stringify(r));var v=f(e,n.getAllResponseHeaders()),m=String(n.response),y=!0,_={};"function"==typeof t.errorFilter&&(y=!!(_=t.errorFilter.call(this,{url:d,status:n.status,response:m,body:w,queryString:g,reqHeaders:h,resHeaders:v})),e.logger.warn("api errorFilter执行结果：",_)),m.length>2048&&(m="[response content too large]");var b=u-n.__reqCtx__.start;if(y&&b<121e3&&c(d)){var x=_.bizCode||n.status,E=_.reqHeaders||h,S=_.resHeaders||v,k={category:a.API,sampleRate:t.sampleRate,w_res:d,w_param:g,w_body:s(x)||!t.withBody?"":w,w_method:n.__reqCtx__.method,w_rc:x,w_rt:b,w_resp:s(x)||!t.withResp?"":_.resp||m,w_hd:JSON.stringify(E),w_trace_reqid:E&&E["x-wpk-reqid"]||void 0,w_rshd:JSON.stringify(S),w_trace_serverid:S&&S["x-wpk-serverid"]||void 0,msg:_.msg||"",w_type:16};l(e,k,_)}}catch(t){e.reportError(t,{bid:o.BID,cid:o.CID,category:a.JSERR,sampleRate:1})}}if("onreadystatechange"in n&&"function"==typeof n.onreadystatechange){var d=n.onreadystatechange;n.onreadystatechange=function(){var e=[].slice.call(arguments);u.apply(this,e),d.apply(this,e)}}else n.onreadystatechange=u;var g=[].slice.call(arguments);return p.apply(this,g)}}(e,u),"fetch"in window&&function(e,t){var r=function(e){var t=(e||"").split("?");return{apiAddr:t[0],queryString:t.length>1&&t[1]||""}},n=function(r,n,o,i,c,u,l,p,d,f,g){var w=e.toolKit.isObject(p)?p:{},h=w.reqHeaders||u,v=w.resHeaders||l;return{w_res:r,w_param:n,w_method:o,w_rc:c,w_rt:i,w_hd:JSON.stringify(h),w_trace_reqid:h&&h["x-wpk-reqid"]||void 0,w_rshd:JSON.stringify(v),w_trace_serverid:v&&v["x-wpk-serverid"]||void 0,msg:w.msg||d||"",w_body:s(c)||!t.withBody?"":f,w_resp:s(c)||!t.withResp?"":w.resp||g||"",category:a.API,sampleRate:t.sampleRate,w_type:17}},u=function(r,n,o,i,a,s,c){var u={};return"function"==typeof t.errorFilter&&(u=t.errorFilter.call(this,{url:r,queryString:n,status:o,body:i,response:a,reqHeaders:s,resHeaders:c}),e.logger.warn("api errorFilter执行结果：",u)),u},p=window.fetch;window.fetch=function(){var s=[].slice.call(arguments),f=i.GET;s[1]&&s[1].method&&(f=s[1].method.toUpperCase());var w,h=s[0];w="string"==typeof h?h:h instanceof URL?h.toString():h.url||"",t.enableTrace&&(d(w)||t.enableCorsTrace(w))&&(s[1]?void 0===s[1].headers&&(s[1].headers={}):s[1]={headers:{}},e.toolKit.forEach(Object.getOwnPropertyNames(t.requestHeaders),(function(e){s[1].headers[e]=t.requestHeaders[e]()})));var v=Date.now(),m="",y=null;return s[1]&&(y=s[1].headers),f!==i.GET&&s[1]&&s[1].body&&(m=JSON.stringify(s[1].body)),p.apply(this,s).then((function(t){try{var i=Date.now(),p=r(t.url||s[0]),d=p.apiAddr,w=p.queryString,h=t.clone(),_=g(h.headers);h.text().then((function(r){r=r||"";var o=u.call(this,d,w,t.status,m,r,y,_),a=!!o;r=r.length>2048?"[response content too large]":r;var s=i-v;if(a&&s<121e3&&c(d)){var p=o.bizCode||t.status,g=n(d,w,f,s,p,y,_,o,void 0,m,r);l(e,g,o)}}))}catch(t){e.reportError(t,{bid:o.BID,cid:o.CID,category:a.JSERR,sampleRate:1})}return t})).catch((function(t){var o=r(s[0]),i=o.apiAddr,a=o.queryString,p=u.call(this,i,a,-1,m,"",y,{}),d=!!p,g=Date.now()-v;if(d&&g<121e3&&c(i)){var w=p.bizCode||-1,h=n(i,a,f,g,w,y,{},p,t.message,m,void 0);l(e,h,p)}throw t}))}}(e,u),(e.enableMtop||u.enableMtop)&&(e.logger.info("use mtop"),function(e,t){window&&window.lib.mtop&&window.lib.mtop.middlewares&&window.lib.mtop.middlewares.push((function(r){var n=this.params,i=this.options,u=Date.now();return r().then((function(){try{if(i.H5Request&&(i.getJSON||i.postJSON))return void e.logger.debug("识别到请求为xhr, api监控交由xhr的方式处理");var r,p=i.retJson||{},d=Date.now()-u,f=p.code||200,g=n.type,w=n.api,h=e.toolKit.objToQueryString(i.querystring),v=i.postdata&&i.postdata.data?e.toolKit.objToJsonString(i.postdata.data):null,m=e.toolKit.objToJsonString(p.data||{}),y=p.ret;y instanceof Array&&(y=y.join(",")),-1===y.indexOf("SUCCESS")&&(r=y);var _=!0,b={};if("function"==typeof t.errorFilter&&(_=!!(b=t.errorFilter.call(this,{url:w,status:f,response:m,body:v,queryString:h,msg:r})),e.logger.warn("api errorFilter执行结果：",b)),_&&d<121e3&&c(w)){var x=b.bizCode||f,E={category:a.API,sampleRate:t.sampleRate,w_res:w,w_param:h,w_body:s(x)||!t.withBody?"":v,w_method:g,w_rc:x,w_rt:d,w_resp:s(x)||!t.withResp?"":b.resp||m,msg:b.msg||r||"",w_type:100};l(e,E,b)}}catch(t){e.reportError(t,{bid:o.BID,cid:o.CID,category:a.JSERR,sampleRate:1})}}))}))}(e,u))):e.logger.info("wpkinterfacePlugin已关闭")}};w.prototype.pluginId="api",e.exports=w},function(e,t,r){var n,o=r(0).env,i=r(0).category,a=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd","msFirstPaint"],s=["navigate","reload","back_forward"],c=function(e){var t,r;if(n&&n.getEntriesByType)try{for(var o=n.getEntriesByType("paint"),i=0;i<o.length;i++){var s=o[i];"first-paint"===s.name?t=parseFloat(s.startTime.toFixed(2)):"first-contentful-paint"===s.name&&(r=parseFloat(s.startTime.toFixed(2)))}}catch(e){console.error(e)}var c=e[a[13]]-e[a[5]];return{w_n_rve:c?parseFloat(c.toFixed(2)):c,fpt:t,fcp:r}},u=function(e,t){var r,n,o,i={},s=e._ver||1;for(var c in t){o=0,r=e[a[t[c][0]]],n=e[a[t[c][1]]],(2===s?r>=0:r>0)&&n>0&&(o=parseFloat((n-r).toFixed(2))),i[c]=o}return i},l=function(e,t){var r=window;if(n=r.performance||r.webkitPerformance||r.msPerformance||r.mozPerformance,e.env===o.BROWSER&&n&&n.timing){t=t||{};var a=e.toolKit.extend({enable:!0,sampleRate:1,collectResTiming:!1,minLoadTiming:3e3,maxLoadTiming:8e3,minLoadSpr:.05,maxLoadSpr:1},t);if(a.enable){e.logger.info("wpkperformancePlugin已开启");var l=n.timing||{},p=1;if("function"==typeof r.PerformanceNavigationTiming)try{var d=n.getEntriesByType("navigation")[0];d&&(l=d,p=2)}catch(e){}l._ver=p;var f=function(){/loaded|complete/.test(document.readyState)&&setTimeout((function(){var t=e.toolKit.extend(function(e){return u(e,{w_unload:[1,2],w_redirect:[3,4],w_appcache:[5,6],w_dns:[6,7],w_tcp:[8,10],w_ssl:[9,10],w_ttfb:[11,12],w_contentdownload:[12,13],w_domparsing:[13,15],w_res:[17,19]})}(l),function(e){var t=u(e,{w_firstbyte:[5,12],w_tti:[5,15],w_domready:[5,17],w_load:[5,19],w_total:[5,20]}),r=c(e);return t.w_n_rve=r.w_n_rve,t.wl_fcp=r.fcp,t.wl_fp=r.fpt,t}(l));for(var r in t)if(t[r]<0||t[r]>6e4)return void e.logger.warn("性能数据异常：",r,t[r]);var o=e.toolKit.extend(t,function(e){var t,r=n.navigation||{},o=-1,i=-1,a=-1;return 1===e._ver?t=s[r.type]||"other":2===e._ver&&(o=e.encodedBodySize,i=e.decodedBodySize,a=e.transferSize,t=e.type),{w_enbdsize:o,w_debdsize:i,w_transize:a,w_navtype:t}}(l),a,{category:i.JSFSPERF});if(e.report(o),(a.collectResTiming||e.toolKit.isQuark()||e.toolKit.isUC())&&!e._hasCollectResTiming){e.logger.info("已开启慢性能resource采集能力");var p=0;t.w_load>=a.minLoadTiming&&t.w_load<=a.maxLoadTiming?p=a.minLoadSpr:t.w_load>a.maxLoadTiming&&(p=a.maxLoadSpr),p&&n&&"function"==typeof n.getEntriesByType&&(e.report({category:i.RESTIMING,sampleRate:p,bl1:JSON.stringify(n.getEntriesByType("resource")),bl2:n.timeOrigin||n.timing.fetchStart,_forcePost:!0}),e._hasCollectResTiming=!0)}}))};e.toolKit.isPageReady(e.prerender)?f():e.toolKit.onPageReady(f,!0,e.prerender)}else e.logger.info("wpkperformancePlugin已关闭")}else e.logger.warn("基础性能插件仅支持浏览器环境")};l.prototype.pluginId="perf",e.exports=l},function(e,t,r){var n=r(0).env,o=function(e,t){if(t=t||{},-1!==[n.BROWSER,n.WEEX].indexOf(e.env)&&t.params&&"string"==typeof t.params){e.logger.info("wpkucparamPlugin已开启");for(var r=t.params,o=["pr","ve","os","fr","nw","ut","sv"],i=0;i<5;i++){var a=o[i];-1===r.indexOf(a)&&(r+=a)}try{"undefined"!=typeof ucapi&&"function"==typeof ucapi.invoke&&(e.uc_param_str=r,ucapi.invoke("biz.ucparams",{params:r,success:function(t){e.uc_param=t||"",e.uc_param_str=""},fail:function(t){e.logger.error("get uc_param_str error: ",t)}}))}catch(t){e.logger.error("get uc_param_str error: ",t),e.uc_param_str=r}}};o.prototype.pluginId="ucparam",e.exports=o},function(e,t,r){var n=r(0),o="undefined"!=typeof weex?weex:{},i=function(){var e={wx_pf:WXEnvironment.platform,wx_ver:WXEnvironment.weexVersion,wx_app:WXEnvironment.appName,wx_app_ver:WXEnvironment.appVersion,wx_os:WXEnvironment.osName,wx_os_ver:WXEnvironment.osVersion,wx_dev_md:WXEnvironment.deviceModel,dsp_w:WXEnvironment.deviceWidth,dsp_h:WXEnvironment.deviceHeight};if(void 0!==weex.config.uc)try{var t=JSON.parse(weex.config.uc.ucParams);e.net=t.nw,e.wx_app=t.pr,e.wx_app_ver=t.ve}catch(e){}return"undefined"!=typeof weex&&weex.config&&weex.config.bundleType&&"Vue"!==weex.config.bundleType&&"vue"!==weex.config.bundleType?("undefined"!=typeof location?e.wx_bdl_url=location.href:e.wx_bdl_url="undefined"!=typeof weex&&weex.config?weex.config.bundleUrl:"unknow",e.wx_bdl_type="Rax"):(e.wx_bdl_url=weex.config.bundleUrl,e.wx_bdl_type="Vue"),e.wx_bdl_name=function(e){try{var t=e.substring(e.lastIndexOf("/")+1);return-1===t.lastIndexOf(".")?t:t.substring(0,t.lastIndexOf("."))}catch(e){return""}}(e.wx_bdl_url),e};e.exports={env:n.env.WEEX,root:o,isHttps:!1,send:function(e,t,r){var n=this.toolKit.extend(i(),r,{w_frmid:this._sid});n.fr=n.wx_os,n.rom=n.wx_os_ver,n.brand=n.wx_dev_md,n.model=n.wx_dev_md,n.browser=n.wx_app,n.bver=n.wx_app_ver,n.w_url=n.wx_bdl_name,n.w_send_mode="weexfetch";var o=encodeURIComponent(t),a=encodeURIComponent(this.toolKit.objToJsonString(n));weex.requireModule("stream").fetch({url:e,method:"POST",headers:{"wpk-header":o},body:a},(function(e,t){}))},getWid:function(){return this.toolKit.uuid()},bindUnloadEvent:function(){}}},function(e,t,r){var n=r(1),o=r(14);e.exports=function(e){var t=new n(e);return t.initialize(o),t}},function(e,t,r){(function(t){var n=r(0),o=t;e.exports={env:n.env.NODEJS,root:o,send:function(e,t,r){}}}).call(this,r(15))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(1),o=r(17);e.exports=function(e){var t=new n(e);return t.initialize(o),t}},function(e,t,r){var n=r(0),o="undefined"!=typeof window?window:"undefined"!=typeof self?self:{},i=o.document,a=o.navigator,s=o.location,c=void 0!==o.devicePixelRatio?o.devicePixelRatio:1,u={},l=null,p=null,d=function(e,t,r,n,o){if(void 0===t){var a,s;if(!u[e]){a=new RegExp(e+"=([^;]+)");try{s=a.exec(i.cookie)}catch(e){return null}s&&(u[e]=s[1])}return u[e]}var c=e+"="+t;n&&(c+="; domain="+n),o&&(c+="; path="+o),r&&(c+="; max-age="+r);try{return i.cookie=c,!!i.cookie}catch(e){return!1}},f=function(e,t){!function(e,t,r,n){void 0!==window.ucapi&&"function"==typeof window.ucapi.invoke?(t&&(t.success=r,t.fail=n),window.ucapi.invoke(e,t)):n&&n("ucapi is not exist")}("webMonitor.reportWpkLog",e,(function(e){t.logger.warn("log reported success by jsapi",e)}),(function(e){t.logger.warn("log report failed by jsapi",e)}))},g=function(e){var t=window,r="wpkimgreporter_"+ +new Date+".r"+Math.floor(1e3*Math.random()),n=t[r]=new Image;n.onload=n.onerror=function(){t[r]=null},n.src=e},w=function(e){var t,r=e._waitingQueue;if(e.checkHidden&&i&&i.hidden)return e.logger.warn("当前页面不可见，日志数据将丢弃: ",r),void(e._waitingQueue=[]);null===l&&(t=(navigator?navigator.userAgent:"").toLowerCase(),l=t.indexOf("windvane")>-1&&/(iphone|ipad|ipod|ios)/i.test(t)),null===p&&(p=e.useNativeCH&&function(e){try{return"undefined"!=typeof window&&void 0!==window.nativeWpkReport&&1===(window.nativeWpkReport||{})[e]}catch(e){return!1}}("enablePerformanceReport"));var n=a&&a.sendBeacon&&o.Blob,s=e.supportBeaconBody&&!l;if(p){for(var c=0;c<r.length;c++)try{var u=r[c];u.w_send_mode="jsapi",u._servAddr=void 0,u._hash=void 0,f({type:u.type,immediate:"jsfsperf"===u.type?0:1,args:u},e)}catch(e){}e._waitingQueue=[]}else if(n&&s){var d,w,h=function(e){for(var t,r,n=[],o=[],i=e.length,a=0;a<i;a++)r=e[a].category,-1===o.indexOf(r)&&o.push(r);t=o.length;for(var s=0;s<t;s++){r=o[s];for(var c=[],u=0;u<i;u++){var l=e[u];l.category===r&&c.push(l)}n[s]=c}return n}(r),v=h.length;try{for(var m,y=0;y<v;y++){m=(d=h[y])[0]._servAddr,w=d.length;for(var _=0;_<w;_++)d[_].w_send_mode="sendbeacon",d[_]._servAddr=void 0,d[_]._hash=void 0,d[_]=e.toolKit.objToJsonString(d[_]);a.sendBeacon(m,encodeURIComponent(d.join("\n")))}e._waitingQueue=[]}catch(e){}}else{for(var b,x,E,S=0;S<r.length;S++){x=(b=r[S])._servAddr,E=b._forcePost,b.w_send_mode=E?"fetch":n?"sendbeacon":"imgsrc",b._servAddr=void 0,b._hash=void 0,b._forcePost=void 0,b=encodeURIComponent(e.toolKit.objToJsonString(b));try{!0===E&&"function"==typeof fetch?fetch(x,{method:"POST",body:b}).then((function(){})).catch((function(){})):n?a.sendBeacon(x+"&data="+b):g(x+"&data="+b)}catch(e){}}e._waitingQueue=[]}},h=null,v=function(e){clearTimeout(h),h=null,w(e)},m=function(e){v(e)};e.exports={env:n.env.BROWSER,root:o,isHttps:s.protocol===n.http.protocols.HTTPS,send:function(e,t,r){var u=this;if(!u.ignoreU4HA&&u.toolKit.isU4HA(u.onlyCustom)&&r.category<100&&(2!==r.category||100!==r.w_type))u.logger.warn("在u4内核环境，屏蔽非自定义的所有自动打点");else if(u.toolKit.inAlipayMiniAppWebview()&&!0===u.blockAlipayMiniAppWebview)u.logger.warn("current runtime is alipay miniapp webview, this request will be blocked.");else{var l=u.toolKit.extend(function(e){if(!i)return{};var t,r=i.referrer;return r&&-1!==r.indexOf('"')&&(r=encodeURIComponent(i.referrer)),{w_url:s.origin+s.pathname,w_query:s.search,w_ref:s.hash.substring(1),w_title:i.title,ua:a.userAgent,referrer:r,dsp_dpi:c||1,dsp_w:o.screen.width,dsp_h:o.screen.height,net:(t=a.connection,t&&t.type?t.type===n.navConn.types.NONE?"disconnected":t.type===n.navConn.types.CELLULAR?t.effectiveType===n.navConn.effectiveTypes.SLOW2G?"2g":t.effectiveType:t.type:"")}}(u.spa),r,{w_frmid:u._sid});if(u.logger.warn("logData to send: ",e,l),e+="?wpk-header="+encodeURIComponent(t),u.uc_param_str&&(e+="&uc_param_str="+u.uc_param_str),!0===r._diagnose)return l=encodeURIComponent(u.toolKit.objToJsonString(l)),void window.open(e+"&data="+l);l._servAddr=e,l._hash=u.toolKit.genContentHash(l);var p,d,f=u.delay&&-1!==[1,2,4].indexOf(l.category);if(function(e,t){var r=e._waitingQueue,n=r.length,o=t.reduplication||e.reduplication||!0,i=!0;if(1===t.category&&o&&0!==n){for(var a,s=0;s<n;s++)if((a=r[s])._hash===t._hash){a.w_cnt++,i=!1;break}i&&r.push(t)}else r.push(t);return i}(u,l)||!f)p=function(){v(u)},h=-1===(d=f?3e3:-1)?(p(),null):setTimeout(p,d||0);else u.logger.warn("logData被合并: ",l)}},getWid:function(){var e=d(n.sdk.WID_KEY);return e||(e=this.toolKit.uuid(),d(n.sdk.WID_KEY,e,15552e3)),e},bindUnloadEvent:function(e){window&&(window.addEventListener?window.addEventListener("beforeunload",(function(t){m(e)}),!1):window.attachEvent&&window.attachEvent("onbeforeunload",(function(t){m(e)})))}}}])}));